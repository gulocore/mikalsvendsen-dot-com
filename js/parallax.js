(()=>{console.log("\u{1F3A8} Loading clean parallax implementation bundle...");var d={canvases:new Map,async detectCapabilities(){try{let a=document.createElement("canvas");if(!a.getContext("2d"))return{canUseCanvas:!1,maxImageSize:0};let t=/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent),i=window.screen.width*window.screen.height,o=navigator.deviceMemory||(t?2:8),n;return o<2||i<5e5||o<4||t?n=1024:n=2048,a.remove(),console.log(`\u{1F3A8} Parallax capabilities: Canvas OK, Max image: ${n}px`),{canUseCanvas:!0,maxImageSize:n,isMobile:t,estimatedMemory:o}}catch(a){return console.warn("\u{1F3A8} Canvas capability check failed:",a),{canUseCanvas:!1,maxImageSize:0}}},async loadImage(a,e){let i=(a.qualities||[{name:"default",suffix:""}]).sort((o,n)=>{let r=this.getQualitySize(o),s=this.getQualitySize(n);return r-s});for(let o of i)if(!(this.getQualitySize(o)>e.maxImageSize))try{let n=this.getImagePath(a,o),r=await this.fetchImage(n);return console.log(`\u2705 Loaded ${o.name||"default"} quality for ${a.name}`),r}catch(n){console.warn(`\u26A0\uFE0F Failed to load ${o.name||"default"} quality:`,n)}throw new Error(`All image qualities failed for layer ${a.name}`)},getQualitySize(a){return a.suffix?.includes("2k")?2048:a.suffix?.includes("1k")?1024:a.suffix?.includes("4k")?4096:1024},getImagePath(a,e){let t=a.format||"jpg",i=e.suffix||"";return`${a.basePath}${i}.${t}`},fetchImage(a){return new Promise((e,t)=>{let i=new Image;i.onload=()=>e(i),i.onerror=()=>t(new Error(`Failed to load: ${a}`)),i.src=a})},createCanvas(a){let e=document.createElement("canvas"),t=e.getContext("2d");return e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.zIndex=(a.zIndex||0).toString(),e.style.pointerEvents="none",e.style.opacity=(a.opacity||1).toString(),e.className=`parallax-canvas parallax-layer-${a.name}`,this.resizeCanvas(e),{canvas:e,ctx:t}},resizeCanvas(a){let e=window.devicePixelRatio||1,t=window.innerWidth,i=window.innerHeight;a.width=t*e,a.height=i*e,a.style.width=t+"px",a.style.height=i+"px",a.getContext("2d").scale(e,e)},drawLayer(a){let{ctx:e,canvas:t,image:i,config:o,lastScrollY:n}=a,r=t.width/(window.devicePixelRatio||1),s=t.height/(window.devicePixelRatio||1);e.clearRect(0,0,r,s);let c=o.speed||1,l=n*c;switch(o.repeat){case"repeat-x":this.drawRepeatedX(e,i,l,r,s);break;case"repeat-y":this.drawRepeatedY(e,i,l,r,s);break;case"repeat":this.drawRepeatedBoth(e,i,l,r,s);break;case"no-repeat":default:this.drawNoRepeat(e,i,l,r,s,o.direction)}},drawNoRepeat(a,e,t,i,o,n){let r=0,s=0;switch(n){case"horizontal":r=-t,s=0;break;case"vertical":r=0,s=-t;break;case"both":r=-t,s=-t;break;default:r=-t,s=0}r+e.width>0&&r<i&&s+e.height>0&&s<o&&a.drawImage(e,r,s)},drawRepeatedX(a,e,t,i,o){let n=e.width,r=-(t%n);for(let s=r;s<i;s+=n)a.drawImage(e,s,0)},drawRepeatedY(a,e,t,i,o){let n=e.height,r=-(t%n);for(let s=r;s<o;s+=n)a.drawImage(e,0,s)},drawRepeatedBoth(a,e,t,i,o){let n=e.width,r=e.height,s=-(t%n);for(let c=s;c<i;c+=n)for(let l=0;l<o;l+=r)a.drawImage(e,c,l)},enhanceAlpineComponent(a){return{...a,async initializeLayers(){if(!this.config?.layers?.length){console.log(`\u{1F3A8} [${this.componentId}] No layers to initialize`);return}console.log(`\u{1F3A8} [${this.componentId}] Initializing ${this.config.layers.length} layers with full canvas implementation...`),this.isActive=!0;try{let e=await d.detectCapabilities();if(this.capabilities=e,!e.canUseCanvas){this.showFallback();return}let t=this.config.layers.map(n=>this.createLayerWithImplementation(n,e).catch(r=>(console.warn(`\u26A0\uFE0F [${this.componentId}] Layer ${n.name} failed:`,r),null))),o=(await Promise.all(t)).filter(Boolean).length;if(o===0)throw new Error("No layers loaded successfully");this.isLoaded=!0,console.log(`\u2705 [${this.componentId}] Parallax loaded: ${o}/${this.config.layers.length} layers`)}catch(e){this.hasError=!0,this.errorMessage=e.message,console.error(`\u274C [${this.componentId}] Parallax initialization failed:`,e),this.showFallback()}},async createLayerWithImplementation(e,t){console.log(`\u{1F3A8} [${this.componentId}] Creating layer with full canvas implementation: ${e.name}`);let i=document.querySelector(`.parallax-layer-${e.name}`);i&&i.remove();let{canvas:o,ctx:n}=d.createCanvas(e),r=await d.loadImage(e,t);this.$el.appendChild(o);let s,c=()=>{s||(s=setTimeout(()=>{this.updateLayerWithImplementation(e.name),s=null},16))},l=e.scrollContainer==="window"?window:document.querySelector(e.scrollContainer)||window;l.addEventListener("scroll",c,{passive:!0});let h={config:e,canvas:o,ctx:n,image:r,scrollListener:c,scrollContainer:l,lastScrollY:0};return this.canvases.set(e.name,h),this.layers.push(h),d.drawLayer(h),h},updateLayerWithImplementation(e){let t=this.canvases.get(e);if(!t)return;let i=t.scrollContainer===window?window.scrollY:t.scrollContainer.scrollTop;i!==t.lastScrollY&&(t.lastScrollY=i,d.drawLayer(t))},handleResize(){console.log(`\u{1F3A8} [${this.componentId}] Handling window resize with full canvas implementation`);for(let[e,t]of this.canvases)d.resizeCanvas(t.canvas),d.drawLayer(t)}}}};window.ParallaxImplementation=d;console.log("\u2705 Clean parallax implementation bundle loaded (no theme detection, pure canvas implementation)");var m=d;})();
