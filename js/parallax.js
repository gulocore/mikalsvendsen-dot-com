(()=>{console.log("\u{1F3A8} Loading clean parallax implementation bundle...");var d={canvases:new Map,async detectCapabilities(){try{let t=document.createElement("canvas");if(!t.getContext("2d"))return{canUseCanvas:!1,maxImageSize:0};let a=/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent),n=window.screen.width*window.screen.height,s=navigator.deviceMemory||(a?2:8),i;return s<2||n<5e5||s<4||a?i=1024:i=2048,t.remove(),console.log(`\u{1F3A8} Parallax capabilities: Canvas OK, Max image: ${i}px`),{canUseCanvas:!0,maxImageSize:i,isMobile:a,estimatedMemory:s}}catch(t){return console.warn("\u{1F3A8} Canvas capability check failed:",t),{canUseCanvas:!1,maxImageSize:0}}},async loadImage(t,e){let n=(t.qualities||[{name:"default",suffix:""}]).sort((s,i)=>{let o=this.getQualitySize(s),r=this.getQualitySize(i);return o-r});for(let s of n)if(!(this.getQualitySize(s)>e.maxImageSize))try{let i=this.getImagePath(t,s),o=await this.fetchImage(i);return console.log(`\u2705 Loaded ${s.name||"default"} quality for ${t.name}`),o}catch(i){console.warn(`\u26A0\uFE0F Failed to load ${s.name||"default"} quality:`,i)}throw new Error(`All image qualities failed for layer ${t.name}`)},getQualitySize(t){return t.suffix?.includes("2k")?2048:t.suffix?.includes("1k")?1024:t.suffix?.includes("4k")?4096:1024},getImagePath(t,e){let a=t.format||"jpg",n=e.suffix||"";return`${t.basePath}${n}.${a}`},fetchImage(t){return new Promise((e,a)=>{let n=new Image;n.onload=()=>e(n),n.onerror=()=>a(new Error(`Failed to load: ${t}`)),n.src=t})},createCanvas(t){let e=document.createElement("canvas"),a=e.getContext("2d");return e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.zIndex=(t.zIndex||0).toString(),e.style.pointerEvents="none",e.style.opacity=(t.opacity||1).toString(),e.className=`parallax-canvas parallax-layer-${t.name}`,this.resizeCanvas(e),{canvas:e,ctx:a}},resizeCanvas(t){let e=window.devicePixelRatio||1,a=window.innerWidth,n=window.innerHeight;t.width=a*e,t.height=n*e,t.style.width=a+"px",t.style.height=n+"px",t.getContext("2d").scale(e,e)},drawLayer(t){let{ctx:e,canvas:a,image:n,config:s,lastScrollY:i}=t,o=a.width/(window.devicePixelRatio||1),r=a.height/(window.devicePixelRatio||1);e.clearRect(0,0,o,r);let l=s.speed||1,c=i*l,h=r/n.height,m=e.createPattern(n,"repeat-x");switch(e.imageSmoothingEnabled=!1,s.repeat){case"repeat-x":this.drawRepeatedX(e,m,c,o,r,h,n.width,n.height);break}},drawRepeatedX(t,e,a,n,s,i,o,r){t.save(),t.scale(i,i);let l=a/i;t.translate(-l,0),t.fillStyle=e,t.fillRect(l,0,n/i,s/i),t.restore()},drawNoRepeat(t,e,a,n,s,i,o,r){let l=0,c=0;switch(i){case"horizontal":l=-a,c=0;break;case"vertical":l=0,c=-a;break;case"both":l=-a,c=-a;break;default:l=-a,c=0}t.drawImage(e,l,c,o,r)},drawRepeatedY(t,e,a,n,s,i,o){let r=-(a%o);for(let l=r;l<s;l+=o)t.drawImage(e,0,l,i,o)},drawRepeatedBoth(t,e,a,n,s,i){t.save(),t.translate(-a,0),t.fillStyle=e,t.fillRect(a,0,n,s),t.restore()},enhanceAlpineComponent(t){return{...t,async initializeLayers(){if(!this.config?.layers?.length){console.log(`\u{1F3A8} [${this.componentId}] No layers to initialize`);return}console.log(`\u{1F3A8} [${this.componentId}] Initializing ${this.config.layers.length} layers with full canvas implementation...`),this.isActive=!0;try{let e=await d.detectCapabilities();if(this.capabilities=e,!e.canUseCanvas){this.showFallback();return}let a=this.config.layers.map(i=>this.createLayerWithImplementation(i,e).catch(o=>(console.warn(`\u26A0\uFE0F [${this.componentId}] Layer ${i.name} failed:`,o),null))),s=(await Promise.all(a)).filter(Boolean).length;if(s===0)throw new Error("No layers loaded successfully");this.isLoaded=!0,console.log(`\u2705 [${this.componentId}] Parallax loaded: ${s}/${this.config.layers.length} layers`)}catch(e){this.hasError=!0,this.errorMessage=e.message,console.error(`\u274C [${this.componentId}] Parallax initialization failed:`,e),this.showFallback()}},async createLayerWithImplementation(e,a){console.log(`\u{1F3A8} [${this.componentId}] Creating layer with full canvas implementation: ${e.name}`);let n=document.querySelector(`.parallax-layer-${e.name}`);n&&n.remove();let{canvas:s,ctx:i}=d.createCanvas(e),o=await d.loadImage(e,a);this.$el.appendChild(s);let r,l=()=>{r||(r=setTimeout(()=>{this.updateLayerWithImplementation(e.name),r=null},16))},c=e.scrollContainer==="window"?window:document.querySelector(e.scrollContainer)||window;c.addEventListener("scroll",l,{passive:!0});let h={config:e,canvas:s,ctx:i,image:o,scrollListener:l,scrollContainer:c,lastScrollY:0};return this.canvases.set(e.name,h),this.layers.push(h),d.drawLayer(h),h},updateLayerWithImplementation(e){let a=this.canvases.get(e);if(!a)return;let n=a.scrollContainer===window?window.scrollY:a.scrollContainer.scrollTop;n!==a.lastScrollY&&(a.lastScrollY=n,d.drawLayer(a))},handleResize(){console.log(`\u{1F3A8} [${this.componentId}] Handling window resize with full canvas implementation`);for(let[e,a]of this.canvases)d.resizeCanvas(a.canvas),d.drawLayer(a)}}}};window.ParallaxImplementation=d;console.log("\u2705 Clean parallax implementation bundle loaded (no theme detection, pure canvas implementation)");var u=d;})();
