(()=>{console.log("\u{1F3A8} Loading clean parallax implementation bundle...");var d={canvases:new Map,async detectCapabilities(){try{let t=document.createElement("canvas");if(!t.getContext("2d"))return{canUseCanvas:!1,maxImageSize:0};let a=/Android|iPhone|iPad|iPod|Mobile/i.test(navigator.userAgent),n=window.screen.width*window.screen.height,i=navigator.deviceMemory||(a?2:8),s;return i<2||n<5e5||i<4||a?s=1024:s=2048,t.remove(),console.log(`\u{1F3A8} Parallax capabilities: Canvas OK, Max image: ${s}px`),{canUseCanvas:!0,maxImageSize:s,isMobile:a,estimatedMemory:i}}catch(t){return console.warn("\u{1F3A8} Canvas capability check failed:",t),{canUseCanvas:!1,maxImageSize:0}}},async loadImage(t,e){let n=(t.qualities||[{name:"default",suffix:""}]).sort((i,s)=>{let o=this.getQualitySize(i),l=this.getQualitySize(s);return o-l});for(let i of n)if(!(this.getQualitySize(i)>e.maxImageSize))try{let s=this.getImagePath(t,i),o=await this.fetchImage(s);return console.log(`\u2705 Loaded ${i.name||"default"} quality for ${t.name}`),o}catch(s){console.warn(`\u26A0\uFE0F Failed to load ${i.name||"default"} quality:`,s)}throw new Error(`All image qualities failed for layer ${t.name}`)},getQualitySize(t){return t.suffix?.includes("2k")?2048:t.suffix?.includes("1k")?1024:t.suffix?.includes("4k")?4096:1024},getImagePath(t,e){let a=t.format||"jpg",n=e.suffix||"";return`${t.basePath}${n}.${a}`},fetchImage(t){return new Promise((e,a)=>{let n=new Image;n.onload=()=>e(n),n.onerror=()=>a(new Error(`Failed to load: ${t}`)),n.src=t})},createCanvas(t){let e=document.createElement("canvas"),a=e.getContext("2d");return e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100vw",e.style.height="100vh",e.style.zIndex=(t.zIndex||0).toString(),e.style.pointerEvents="none",e.style.opacity=(t.opacity||1).toString(),e.className=`parallax-canvas parallax-layer-${t.name}`,this.resizeCanvas(e),{canvas:e,ctx:a}},resizeCanvas(t){let e=window.devicePixelRatio||1,a=window.innerWidth,n=window.innerHeight;t.width=a*e,t.height=n*e,t.style.width=a+"px",t.style.height=n+"px",t.getContext("2d").scale(e,e)},drawLayer(t){let{ctx:e,canvas:a,image:n,config:i,lastScrollY:s}=t,o=a.width/(window.devicePixelRatio||1),l=a.height/(window.devicePixelRatio||1);e.clearRect(0,0,o,l);let r=i.speed||1,c=s*r,h=l/n.height,m=n.width*h,u=l,w=document.createElement("canvas"),g=w.getContext("2d");w.width=m,w.height=u,g.drawImage(n,0,0,m,u);let p=e.createPattern(w,"repeat-x");switch(i.repeat){case"repeat-x":this.drawRepeatedX(e,p,c,o,l,m);break;case"repeat-y":this.drawRepeatedY(e,n,c,o,l,m,u);break;case"repeat":this.drawRepeatedBoth(e,p,c,o,l,m);break;case"no-repeat":default:this.drawNoRepeat(e,n,c,o,l,i.direction,m,u)}},drawRepeatedX(t,e,a,n,i,s){t.save(),t.translate(-a,0),t.fillStyle=e,t.fillRect(a,0,n,i),t.restore()},drawNoRepeat(t,e,a,n,i,s,o,l){let r=0,c=0;switch(s){case"horizontal":r=-a,c=0;break;case"vertical":r=0,c=-a;break;case"both":r=-a,c=-a;break;default:r=-a,c=0}t.drawImage(e,r,c,o,l)},drawRepeatedY(t,e,a,n,i,s,o){let l=-(a%o);for(let r=l;r<i;r+=o)t.drawImage(e,0,r,s,o)},drawRepeatedBoth(t,e,a,n,i,s){t.save(),t.translate(-a,0),t.fillStyle=e,t.fillRect(a,0,n,i),t.restore()},enhanceAlpineComponent(t){return{...t,async initializeLayers(){if(!this.config?.layers?.length){console.log(`\u{1F3A8} [${this.componentId}] No layers to initialize`);return}console.log(`\u{1F3A8} [${this.componentId}] Initializing ${this.config.layers.length} layers with full canvas implementation...`),this.isActive=!0;try{let e=await d.detectCapabilities();if(this.capabilities=e,!e.canUseCanvas){this.showFallback();return}let a=this.config.layers.map(s=>this.createLayerWithImplementation(s,e).catch(o=>(console.warn(`\u26A0\uFE0F [${this.componentId}] Layer ${s.name} failed:`,o),null))),i=(await Promise.all(a)).filter(Boolean).length;if(i===0)throw new Error("No layers loaded successfully");this.isLoaded=!0,console.log(`\u2705 [${this.componentId}] Parallax loaded: ${i}/${this.config.layers.length} layers`)}catch(e){this.hasError=!0,this.errorMessage=e.message,console.error(`\u274C [${this.componentId}] Parallax initialization failed:`,e),this.showFallback()}},async createLayerWithImplementation(e,a){console.log(`\u{1F3A8} [${this.componentId}] Creating layer with full canvas implementation: ${e.name}`);let n=document.querySelector(`.parallax-layer-${e.name}`);n&&n.remove();let{canvas:i,ctx:s}=d.createCanvas(e),o=await d.loadImage(e,a);this.$el.appendChild(i);let l,r=()=>{l||(l=setTimeout(()=>{this.updateLayerWithImplementation(e.name),l=null},16))},c=e.scrollContainer==="window"?window:document.querySelector(e.scrollContainer)||window;c.addEventListener("scroll",r,{passive:!0});let h={config:e,canvas:i,ctx:s,image:o,scrollListener:r,scrollContainer:c,lastScrollY:0};return this.canvases.set(e.name,h),this.layers.push(h),d.drawLayer(h),h},updateLayerWithImplementation(e){let a=this.canvases.get(e);if(!a)return;let n=a.scrollContainer===window?window.scrollY:a.scrollContainer.scrollTop;n!==a.lastScrollY&&(a.lastScrollY=n,d.drawLayer(a))},handleResize(){console.log(`\u{1F3A8} [${this.componentId}] Handling window resize with full canvas implementation`);for(let[e,a]of this.canvases)d.resizeCanvas(a.canvas),d.drawLayer(a)}}}};window.ParallaxImplementation=d;console.log("\u2705 Clean parallax implementation bundle loaded (no theme detection, pure canvas implementation)");var y=d;})();
